<!DOCTYPE html>
<html lang="da">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Skaleret Display Viewer</title>
    <style>
      body,
      html {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        background: #000;
      }

      .container {
        position: relative;
        width: 100%;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        background-color: #000;
      }

      .scaled-frame {
        width: 1920px;
        height: 1080px;
        transform-origin: center;
        position: relative;
        overflow: hidden;
      }

      iframe {
        width: 100%;
        height: 100%;
        border: none;
        background-color: #00407a;
      }

      .resolution-indicator {
        position: absolute;
        bottom: 5px;
        right: 5px;
        background-color: rgba(0, 0, 0, 0.7);
        color: white;
        padding: 3px 6px;
        border-radius: 3px;
        font-size: 10px;
        z-index: 10;
      }

      .controls {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 30px;
        background-color: rgba(0, 0, 0, 0.6);
        display: flex;
        align-items: center;
        justify-content: flex-end;
        padding: 0 10px;
        opacity: 0;
        transition: opacity 0.3s;
        z-index: 20;
      }

      .container:hover .controls {
        opacity: 1;
      }

      .control-button {
        background: transparent;
        border: none;
        color: white;
        padding: 3px 8px;
        cursor: pointer;
        font-size: 12px;
        margin-left: 10px;
      }

      .control-button:hover {
        background-color: rgba(255, 255, 255, 0.2);
        border-radius: 3px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="scaled-frame" id="scaledFrame">
        <iframe id="displayFrame" src="about:blank"></iframe>
        <div class="resolution-indicator">1920×1080</div>
      </div>
      <div class="controls">
        <button class="control-button" id="refreshBtn">Opdater</button>
        <button class="control-button" id="fullscreenBtn">Fuld skærm</button>
      </div>
    </div>

    <script>
      // Element references
      const container = document.querySelector(".container");
      const scaledFrame = document.getElementById("scaledFrame");
      const displayFrame = document.getElementById("displayFrame");
      const refreshBtn = document.getElementById("refreshBtn");
      const fullscreenBtn = document.getElementById("fullscreenBtn");

      // Get URL parameters
      function getUrlParam(name) {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(name);
      }

      // Initialize with parameters
      function init() {
        // Check for display mode parameters
        const template = getUrlParam("template") || "results";
        const kommune = getUrlParam("kommune");
        const valgsted = getUrlParam("valgsted");
        const viewerType = getUrlParam("viewer") || "preview";

        // Build URL for the display
        let displayUrl = "display.html?mode=display";

        if (template) {
          displayUrl += `&template=${template}`;
        }

        if (kommune) {
          displayUrl += `&kommune=${kommune}`;
        }

        if (valgsted && template === "stations") {
          displayUrl += `&valgsted=${valgsted}`;
        }

        // Load the display
        displayFrame.src = displayUrl;

        // Set scaling based on container size
        adjustScale();

        // Set up window resize listener
        window.addEventListener("resize", adjustScale);

        // Set up buttons
        refreshBtn.addEventListener("click", () => {
          displayFrame.src = displayFrame.src;
        });

        fullscreenBtn.addEventListener("click", () => {
          if (container.requestFullscreen) {
            container.requestFullscreen();
          } else if (container.webkitRequestFullscreen) {
            container.webkitRequestFullscreen();
          } else if (container.msRequestFullscreen) {
            container.msRequestFullscreen();
          }
        });

        // Message passing
        window.addEventListener("message", (event) => {
          // Forward messages to the display iframe
          if (displayFrame.contentWindow && event.data) {
            displayFrame.contentWindow.postMessage(event.data, "*");
          }
        });
      }

      // Adjust scale to fit container
      function adjustScale() {
        const containerWidth = container.clientWidth;
        const containerHeight = container.clientHeight;

        // Calculate scale factor (minimum of width or height ratio)
        const scaleX = containerWidth / 1920;
        const scaleY = containerHeight / 1080;
        const scale = Math.min(scaleX, scaleY);

        // Apply scale
        scaledFrame.style.transform = `scale(${scale})`;
      }

      // Initialize when DOM is ready
      document.addEventListener("DOMContentLoaded", init);
    </script>
  </body>
</html>
